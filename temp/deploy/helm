# Helm Chart for Service Router Operator

apiVersion: v2
name: service-router-operator
description: A Helm chart for deploying the Service Router Operator on Kubernetes.
type: application
version: 0.1.0
appVersion: "1.0"

# Define the dependencies for the Helm chart
dependencies:
  - name: cert-manager
    version: "v1.5.3"
    repository: "https://charts.jetstack.io"

# Define the values that can be overridden in the Helm chart
values:
  replicaCount: 1
  image:
    repository: your-docker-repo/service-router-operator
    pullPolicy: IfNotPresent
    tag: "latest"
  service:
    type: ClusterIP
    port: 80
  rbac:
    create: true
  resources: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}

# Define the templates for the Kubernetes resources
templates:
  - deployment.yaml
  - service.yaml
  - rbac.yaml
  - crd.yaml

# Define the default values for the templates
deployment.yaml:
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: {{ include "service-router-operator.fullname" . }}
    labels:
      {{- include "service-router-operator.labels" . | nindent 4 }}
  spec:
    replicas: {{ .Values.replicaCount }}
    selector:
      matchLabels:
        {{- include "service-router-operator.selectorLabels" . | nindent 8 }}
    template:
      metadata:
        labels:
          {{- include "service-router-operator.selectorLabels" . | nindent 12 }}
      spec:
        containers:
          - name: service-router-operator
            image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
            imagePullPolicy: {{ .Values.image.pullPolicy }}
            ports:
              - containerPort: 80
            resources:
              {{- toYaml .Values.resources | nindent 12 }}

service.yaml:
  apiVersion: v1
  kind: Service
  metadata:
    name: {{ include "service-router-operator.fullname" . }}
    labels:
      {{- include "service-router-operator.labels" . | nindent 4 }}
  spec:
    type: {{ .Values.service.type }}
    ports:
      - port: {{ .Values.service.port }}
        targetPort: 80
    selector:
      {{- include "service-router-operator.selectorLabels" . | nindent 6 }}

rbac.yaml:
  apiVersion: rbac.authorization.k8s.io/v1
  kind: Role
  metadata:
    name: {{ include "service-router-operator.fullname" . }}
  rules:
    - apiGroups: ["*"]
      resources: ["*"]
      verbs: ["*"]

crd.yaml:
  apiVersion: apiextensions.k8s.io/v1
  kind: CustomResourceDefinition
  metadata:
    name: servicerouters.example.com
  spec:
    group: example.com
    versions:
      - name: v1
        served: true
        storage: true
        schema:
          openAPIV3Schema:
            type: object
            properties:
              spec:
                type: object
                properties:
                  # Define your custom resource fields here
    scope: Namespaced
    names:
      plural: servicerouters
      singular: servicerouter
      kind: ServiceRouter
      shortNames:
        - sr